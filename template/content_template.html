<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>
            {% block title %}
            {% endblock %}
    </title>

    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="stylesheet" type="text/css" href="/static/css/iview.css">
    <script type="text/javascript" src="/static/js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="/static/js/vue.js"></script>
    <script type="text/javascript" src="/static/js/iview.js"></script>
    <script type="text/javascript">
        function DefineDate() {
            var now = new Date().toTimeString();
            document.getElementById('clock').innerText=now
        }
        function tmp_now() {
            var now = new Date().toTimeString();
            document.write(now)
        }
        setInterval('DefineDate()',1000);

        $(function() {
            $.ajax(
                {
                    type:'GET',
                    dataTtpe:'json',
                    url:"/user_info",
                    data:'',
                    success: function (result) {
                        $('#nickname').html(result['nickname'])

                    },
                }
            )
        })
    </script>

</head>
<body>

<div id="app" >
    <div class="top" align="center">
        <h1 >
            {% block H1 %}

            {% endblock %}
        </h1>
        <p>
            <p class="topic" >
            {% block topic %}
                个人中心
            {% endblock %}
            </p>
            <div class="logout">
                欢迎, <span id="nickname"></span>， <Icon type="clock"></Icon> 当前时间 <span id="clock"><script>tmp_now()</script></span>

            </div>
        </p>
        <a href="/" ><img src="/static/img/etlucency.png" class="titlealien"> </a>
     </div>
    <div class="personal_center">
        <dropdown style="margin-left: 20px">
    {#    <i-button type="primary">#}
    {#    个人中心#}
    {#    <icon type="arrow-down-b"></icon>#}
    {#    </i-button>#}
            <a><badge dot size="14" ><avatar src="/static/img/etlucency.png" size="large" /></badge></a>
            <dropdown-menu slot="list">
                <dropdown-item><a href="/">个人中心</a></dropdown-item>
                <dropdown-item>修改资料</dropdown-item>
                <dropdown-item><p @click="change_password">修改密码</p></dropdown-item>
                <dropdown-item>应用中心</dropdown-item>
                <dropdown-item disabled>冰糖葫芦</dropdown-item>
                <dropdown-item divided><a href="/logout" >退出登录</a></dropdown-item>
            </dropdown-menu>
        </dropdown>
    </div>
    <div class="middle">
        <div class="middlep" >
            {% block middle_content %}
            {% endblock %}
        </div>
    </div>
    <i-button type="primary" shape="circle" icon="ios-search">Search</i-button>


    <div class="tail">
        {% block tail %}
            <a href="http://www.w3school.com.cn/index.html" target="_blank">w3school</a>
            <a href="https://github.com/alvinwancn" target="_blank">alvin的github</a>
            <a href="https://www.elastic.co/" target="_blank">ELK Stack</a>
            <a href="https://baidu.com" target="_blank">baidu.com</a>
            <a href="https://www.iviewui.com/docs/guide/install" target="_blank">iView</a>
        {% endblock %}
    </div>
    <i-button @click="show">Click me!</i-button>
{#    <Modal v-model="visible" title="Welcome">Welcome to iView</Modal>#}

{#    <Modal v-model="show_change_password" title="修改密码"  ok-text="确认修改" @on-ok="confirm_password(formPassword)">#}
{#        <i-form ref="formPassword" :model="formPassword" :label-width="80">#}
{#            <form-item label="当前密码 " prop="passwd">#}
{#                <i-input type="password" v-model="formPassword.oldpasswd"></i-input>#}
{#            </form-item>#}
{#            <form-item label="修改密码" prop="passwd">#}
{#                <i-input type="password" v-model="formPassword.passwd"></i-input>#}
{#            </form-item>#}
{#            <form-item label=确认密码 prop="passwdCheck">#}
{#                <i-input type="password" v-model="formPassword.passwdCheck"></i-input>#}
{#            </form-item>#}
{#        </i-form>#}
{##}
{#    </Modal>#}
<Modal v-model="show_change_password" title="修改密码" width="40"  :closable='false' :mask-closable=false>
 <i-form ref="formPassword" :model="formPassword" :label-width="80">
            <form-item label="当前密码 " prop="passwd">
                <i-input type="password" v-model="formPassword.oldpasswd"></i-input>
            </form-item>
            <form-item label="修改密码" prop="passwd">
                <i-input type="password" v-model="formPassword.passwd"></i-input>
            </form-item>
            <form-item label=确认密码 prop="passwdCheck">
                <i-input type="password" v-model="formPassword.passwdCheck"></i-input>
            </form-item>
        </i-form>
                <div slot="footer">
                      <i-button type="text" @click="cancel_update_password">取消</i-button>
                      <i-button type="primary" :loading="savePassLoading" @click="confirm_password(formPassword)">确认修改</i-button>
                  </div>
            </Modal>

</div>

<script>
    new Vue({
        el: '#app',
        data: {
            visible: false,
            show_change_password:false,
            savePassLoading:false,
            cpassword:'',
            mpassword:'',
            fpassword:'',
            formPassword: {
                    oldpasswd: '',
                passwd: '',
                passwdCheck: '',
            },

        },
        delimiters:['${', '}'],

        methods: {
            show: function () {
                this.visible = true;
            },
            change_password:function () {
                this.show_change_password = true
            },
            confirm_password:function (name) {
                var lastUp = this;
                $.ajax({
                    type: "POST",//方法类型
                    dataType: "json",//预期服务器返回的数据类型
                    url: "/change_password" ,//url
{#                    data: $('#form1').serialize(),#}
                    data:name,
                    success: function (result) {
                        console.log(result);//打印服务端返回的数据(调试用)
                        if (result.code == 0) {
                            lastUp.show_change_password=false
                            lastUp.$Message.success(result.message)
                        }else {
                            lastUp.$Message.warning(result.message)
                        };
                    },
                    error : function() {
{#                        alert("异常！");#}
                        lastUp.$Message.error('something is error')
                    }
                });
            },
            cancel_update_password:function () {
             this.show_change_password=false
            }



        }

    })

  </script>


</body>
</html>
